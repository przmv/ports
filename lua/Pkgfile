# Description: A powerful light-weight programming language designed for extending applications
# URL: http://www.lua.org/
# Maintainer: Peter A. Shevtsov, pshevtsov at severusweb dot com
# Packager: Peter A. Shevtsov, pshevtsov at severusweb dot com
# Depends on:

name=lua
version=5.2.1
release=3
source=(http://www.lua.org/ftp/$name-$version.tar.gz
liblua.so.patch
lua.pc)

build() {
    cd $name-$version
    patch -p1 -i "$SRC/liblua.so.patch"
    [[ `uname -m` == x86_64 ]] && export CFLAGS="$CFLAGS -fPIC"
    make MYCFLAGS="$CFLAGS" MYLDFLAGS="$LDFLAGS" linux
    sed "s/%VER%/${version%.*}/g;s/%REL%/$version/g" ../lua.pc > lua.pc
    make \
        TO_LIB="liblua.a liblua.so liblua.so.5.2 liblua.so.$version" \
        INSTALL_DATA="cp -d" \
        INSTALL_TOP="$PKG/usr" \
        INSTALL_MAN="$PKG/usr/share/man/man1" \
        install
    install -Dm644 lua.pc "$PKG/usr/lib/pkgconfig/lua.pc"
}
